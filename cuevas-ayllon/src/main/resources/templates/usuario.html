<!DOCTYPE html>
<html>

<head th:replace="layouts/fragmentoUsuarios :: head"></head>

<body class="bodyUsuario">

  <nav th:replace="layouts/fragmentoUsuarios :: nav"></nav>

  <div class="container py-4" style=" width: 1000%; border-radius: 8px; margin-bottom: 3%; margin-top: 3%;">
    <div class="card-body"
      style=" width: 100%; border-radius: 8px; background-color: rgb(47 122 161 / 56%);padding: 30px;box-shadow: 0px 0px 10px 5px rgb(0 0 0 / 70%);">
      <p style="font-size: 30px; font-style:aria-current;color: white;"> Este espacio va dirigido a que los vecinos propongan
        propuestas para que las mas interesantes y que tengan mas aprobacion pueda ser estudiada
        su viabilidad para poder realizarlas</p>

    </div>

  </div>

  <!-- <div class="container py-4" > -->

  <div class="card-body" th:object="${usuario}" style="
    width: 25%;
    border-radius: 8px;
    float: left;
    background-color: rgb(47 122 161 / 56%);
    margin-left: 24%;
    box-shadow: 0px 0px 10px 5px rgb(0 0 0 / 70%);">
    <!-- <div class="container" th:object="${unUsuario}">
                <legend>Informacion Usuario</legend> -->
    <img class="img-thumbnail  float-left" style="max-width: 25% ;float: left; margin: 10px; border-radius: 8px;"
      th:src="@{'/uploads/'+${usuario.foto}}" th:alt="${usuario.foto}" />

    <ul class="list-group">
      <div class="row">
        <div class="col-xs-5">
          <li type="text" id="nombre" th:text="${usuario.nombre.toUpperCase()}"
            class="list-group-item rounded float-right" style="margin: 10px;">
          </li>
        </div>

        <div class="col-xs-5">
          <li type="text" id="apellido1" th:text="${usuario.apellido1.toUpperCase()}"
            class="list-group-item rounded float-right" style="margin: 10px;">
          </li>
        </div>

        <div class="col-xs-5">
          <li type="text" id="apellido2" th:text="${usuario.apellido2.toUpperCase()}"
            class="list-group-item rounded float-right" style="margin: 10px;">
          </li>
        </div>
      </div>
      <!-- <li type="text" id="email" th:text="${usuario.email.toUpperCase()}" class="list-group-item rounded float-right"
          style="margin: 10px;">
        </li> -->
    </ul>
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#staticBackdrop"
      style="margin: 10px;color: #eeeeee;background-color: #463232a3;">
      Realizar Propuesta
    </button>
    <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#staticBackdrop1"
      style="margin: 10px;color: #eeeeee;background-color: #463232a3;">
      Editar Usuario
    </button>

    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
      aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Propuesta</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <label form="titulo" class="col-form-label col-sm-2" maxlength="50">Titulo</label>
            <input type="text" id="titulo" class="form-control">
            <textarea id="texto" name="texto" rows="4" cols="50" style=" height: 180px; width: 98%; margin-top: 10px;"
              maxlength="255">
            </textarea>
            <button type="button" id="enviarPropuesta">enviar propuestas</button>
            <p class="text-start">Realiza tu propuesta para que la conozcan los demas vecinos</p>
          </div>
          <h2 id="propuestaRelizada"></h2>
          <h2 id="propuestaExistente"></h2>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

          </div>

        </div>
      </div>
    </div>
    <div class="modal fade" id="staticBackdrop1" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
      aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel1">Editar Usuario</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form th:action="@{/editarUsuario}" th:object="${usuario}" id="formularioRegistro" class="text-dark" style="width: 250%;
        padding: 30px;" method="post" enctype="multipart/form-data">
              <div class="row col-sm-4">
                <label form="nombre" class="col-form-label col-sm-2" th:text="${nombre}"></label>
              </div>
              <div class="row col-sm-4">
                <input type="text" id="nombre" th:field="*{nombre}" class="form-control" maxlength="20" placeholder="Nombre">
                <div th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}" class="alert alert-danger">
                </div>
              </div>
              <div class="row col-sm-4">
                <label form="apellido1" class="col-form-label col-sm-2" th:text="${apellido1}"></label>
              </div>
              <div class="row col-sm-4">
                <input type="text" id="apellido1" th:field="*{apellido1}" maxlength="20" class="form-control"
                  placeholder="Primer Apellido">
                <div th:if="${#fields.hasErrors('apellido1')}" th:errors="*{apellido1}"  class="alert alert-danger">
                </div>
              </div>
              <div class="row col-sm-4">
                <label form="apellido2" class="col-form-label col-sm-2" th:text="${apellido2}"></label>
              </div>
              <div class="row col-sm-4">
                <input type="text" id="apellido2" th:field="*{apellido2}" maxlength="20"  class="form-control"
                  placeholder="Segundo Apellido">
                <div th:if="${#fields.hasErrors('apellido2')}" th:errors="*{apellido2}" class="alert alert-danger">
                </div>
              </div>
              <div class="row col-sm-4">
                <label form="email" class="col-form-label col-sm-2" th:text="${email}"></label>
              </div>
              <div class="row col-sm-4">
                <input type="text" id="email" th:field="*{email}" class="form-control" placeholder="@Email">
                <div th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="alert alert-danger">
                </div>
              </div>
              <div class="row col-sm-4">
                <label form="direccion" class="col-form-label col-sm-6" th:text="${direccion}"></label>
              </div>
              <div class="row col-sm-4">
                <input type="text" id="direccion" th:field="*{direccion}" class="form-control"
                  placeholder="Direccion del Pueblo">
                <div th:if="${#fields.hasErrors('direccion')}" th:errors="*{direccion}" class="alert alert-danger">
                </div>
              </div>
              <div class="row col-sm-4">
                <label form="file" class="col-form-label col-sm-2" th:text="${foto}"></label>
              </div>
              <div class="row col-sm-4">
                <input type="file" id="foto" name="file" class="form-control">
                <div th:if="${#fields.hasErrors('foto')}" th:errors="*{foto}" class="alert alert-danger">
                </div>
              </div>
              <div class="row col-sm-4">
                <label form="password" class="col-form-label col-sm-2" th:text="${Password}"></label>
              </div>
              <div class="row col-sm-4">
                <input type="password" id="password" th:field="*{password}" class="form-control"
                  placeholder="Contrase単a">
                <div th:if="${#fields.hasErrors('password')}" th:errors="*{password}" class="alert alert-danger">
                </div>
              </div></br></br>
              <input type="hidden" id="password" th:field="*{idUsuario}" class="form-control">
              <div class="row col-sm-2">
                <input type="submit" id="enviarAlta" value="ENVIAR" class="btn btn-primary">
              </div>

            </form>
          </div>
          <h2 id="propuestaRelizada"></h2>
          <h2 id="propuestaExistente"></h2>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

          </div>

        </div>
      </div>
    </div>




  </div>
  <!-- </div> -->

  <!-- <div class="container py-4" > -->

  <div class="card-body" style="
      width: 25%;
      border-radius: 8px;
      float: left;
      background-color: rgb(47 122 161 / 56%);
      margin-left: 2%;
      overflow: scroll;
      box-shadow: 0px 0px 10px 5px rgb(0 0 0 / 70%);
      
    height: 500px" id="todasPropuestas">

  </div>
  <!-- </div> -->

  <!-- <footer th:replace="layouts/fragmentoUsuarios :: footer"></footer> -->


</body>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>

  $(document).ready(function () {
    $.ajax({

      type: 'get',
      url: "propuesta",



    }).done(function (data) {
      console.log("El valor devuelto por peotestas es: " + data);
      var html2 = '';
      html2 += '<table  class="table table-condensed" border="1">';
      html2 += '<thead>';
      html2 += '<tr> ';
      html2 += '<th style="color:white">TITULO DE LAS PROPUESTAS</th>';
      html2 += '</tr>';
      html2 += '</thead>';


      for (var i = 0; i < data.length; i++) {

        console.log('estamos en la tabla', data)
        html2 += '<tr> ';
        html2 += '<div class="row">';
        html2 += '<div class="col-xs-5">';
        html2 += "<td><a class='btn btn-dark' style='color: #eeeeee;background-color: #463232a3;'  href=comentarios?idPropuesta=" + data[i].idPropuesta + ">" + data[i].titulo.toUpperCase() + "</a></td>";
        html2 += '</div>';
        html2 += '</div>';
        html2 += "</tr>"

      }
      html2 += '<tr> ';
      html2 += '<td id="anadirPropuesta"> </td>';
      html2 += "</tr>";

      html2 += " </table>";
      $('#todasPropuestas').append(html2);

    });
  })

  $('#enviarPropuesta').on('click', function () {
    // var div = document.getElementById('todasPropuestas');
    // while (div.firstChild) {
    //   div.removeChild(div.firstChild);
    // }
    var propuestaExito = "La propuesta se ha a単adido con exito";
    var propuestaNoExito = "La propuesta se ha a単adido con exito";

    $.ajax({
      type: 'POST',
      url: "propuesta",
      data: { 'propuesta': $('#texto').val(), 'titulo': $('#titulo').val() }
    }).done(function (data) {
      if (data.titulo !== null) {

        console.log("El valor devuelto por la a単adir propuestaq es este: " + data);
        var html2 = '';
        console.log('estamos en la tabla', data)
        html2 += "<a class='btn' href=comentarios?idPropuesta=" + data.idPropuesta + ">" + data.titulo + "</a>";
        $('#anadirPropuesta').append(html2);
      }
    });
  })







</script>

</html>